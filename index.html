<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PLC (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï PDF)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f7fafc; }
        .form-container { max-width: 56rem; margin: 2rem auto; background: white; padding: 2.5rem; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .tab-button { transition: all 0.3s; }
        .tab-button.active { border-color: #3B82F6; background-color: #3B82F6; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        /* --- UPDATED STYLES FOR THE NEW PDF TEMPLATE --- */
        .output-page { font-family: 'Sarabun', sans-serif; width: 210mm; min-height: 297mm; padding: 15mm; background: white; color: black; position: absolute; left: -9999px; top: 0; box-sizing: border-box; font-size: 11pt; }
        .output-page .header { text-align: center; font-weight: bold; font-size: 12pt; line-height: 1.6; display: flex; align-items: center; justify-content: center; }
        .output-page .header svg { height: 50px; width: 50px; margin-right: 15px; }
        .output-page .main-table, .output-page .main-table th, .output-page .main-table td { border: 1px solid black; border-collapse: collapse; }
        .output-page .main-table td { padding: 4pt 6pt; vertical-align: top; }
        .output-page .td-header { vertical-align: middle; font-weight: bold; }
        .output-page .content-cell { white-space: pre-wrap; word-wrap: break-word; min-height: 3em; }
        .output-page .signature-section { margin-top: 2rem; padding: 0 1rem; display: flex; justify-content: space-around; text-align: center; line-height: 1.8; }
        .output-page .signature-block p { margin: 0; }
        #output-page-2 { text-align: center; }
        #output-page-2 img { max-width: 80mm; max-height: 110mm; margin: 5px; display: inline-block; border: 1px solid #ccc; object-fit: contain; }
        .loader { border: 8px solid #f3f3f3; border-radius: 50%; border-top: 8px solid #3498db; width: 60px; height: 60px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="max-w-5xl mx-auto p-4">
        <!-- Tab Navigation -->
        <div class="mb-6 flex justify-center border-b">
            <button data-tab="form" class="tab-button active text-lg font-semibold py-3 px-6 border-b-4">üìù ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
            <button data-tab="dashboard" class="tab-button text-lg font-semibold py-3 px-6 border-b-4 border-transparent">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
        </div>

        <!-- Tab Content -->
        <div id="form-tab" class="tab-content active">
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PLC</h1>
                <form id="plc-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="school-name" class="font-semibold">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label><input type="text" id="school-name" value="" class="w-full mt-1 p-2 border rounded-md"></div>
                        <div><label for="office-name" class="font-semibold">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</label><input type="text" id="office-name" value="" class="w-full mt-1 p-2 border rounded-md"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="plc-level" class="font-semibold">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô:</label><input type="text" id="plc-level" value="" class="w-full mt-1 p-2 border rounded-md"></div>
                        <div><label for="plc-number" class="font-semibold">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà:</label><input type="text" id="plc-number" value="" class="w-full mt-1 p-2 border rounded-md"></div>
                    </div>
                    <fieldset class="border p-4 rounded-lg">
                        <legend class="font-bold text-lg px-2 text-gray-700">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label for="plc-date" class="font-bold">‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</label><input type="date" id="plc-date" class="w-full mt-1 p-2 border rounded-md"></div>
                            <div><label for="plc-location" class="font-bold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label><input type="text" id="plc-location" value="" class="w-full mt-1 p-2 border rounded-md"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div><label for="plc-time-start" class="font-bold">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="time" id="plc-time-start" class="w-full mt-1 p-2 border rounded-md"></div>
                            <div><label for="plc-time-end" class="font-bold">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label><input type="time" id="plc-time-end" class="w-full mt-1 p-2 border rounded-md"></div>
                            <div><label for="plc-hours" class="font-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</label><input type="text" id="plc-hours" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" readonly class="w-full mt-1 p-2 border rounded-md bg-gray-100"></div>
                        </div>
                    </fieldset>
                    <fieldset class="border p-4 rounded-lg">
                        <legend class="font-bold text-lg px-2 text-gray-700">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡πÅ‡∏•‡∏∞ ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°</legend>
                        <div class="mb-4"><label for="plc-leader" class="font-bold">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° PLC:</label><input type="text" id="plc-leader" value="" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°" class="w-full md:w-1-2 mt-1 p-2 border rounded-md"></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2">
                            <input type="text" id="member-1" placeholder="1. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-2" placeholder="2. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-3" placeholder="3. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-4" placeholder="4. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-5" placeholder="5. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-6" placeholder="6. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-7" placeholder="7. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-8" placeholder="8. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-9" placeholder="9. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md"><input type="text" id="member-10" placeholder="10. ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" class="p-2 border rounded-md">
                        </div>
                    </fieldset>
                    <div class="space-y-4">
                        <div><label for="topic" class="font-bold text-gray-700">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö :</label><textarea id="topic" rows="2" class="w-full mt-1 p-2 border rounded-md"></textarea></div>
                        <div><label for="reason" class="font-bold text-gray-700">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ :</label><textarea id="reason" rows="2" class="w-full mt-1 p-2 border rounded-md"></textarea></div>
                        <div><label for="solution" class="font-bold text-gray-700">‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç :</label><textarea id="solution" rows="2" class="w-full mt-1 p-2 border rounded-md"></textarea></div>
                        <div><label for="tools" class="font-bold text-gray-700">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠/‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏õ‡∏±‡∏ç‡∏´‡∏≤ :</label><textarea id="tools" rows="2" class="w-full mt-1 p-2 border rounded-md"></textarea></div>
                        <div><label for="results" class="font-bold text-gray-700">‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç :</label><textarea id="results" rows="4" class="w-full mt-1 p-2 border rounded-md"></textarea></div>
                    </div>
                    <fieldset class="border p-4 rounded-lg">
                        <legend class="font-bold text-lg px-2 text-gray-700">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏£‡∏π‡∏õ)</legend>
                        <label for="image-upload" class="block mb-2 text-sm font-medium text-gray-900">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
                        <input type="file" id="image-upload" multiple accept="image/*" class="block w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 cursor-pointer focus:outline-none">
                        <div id="image-preview" class="mt-4 grid grid-cols-2 gap-4"></div>
                    </fieldset>
                     <fieldset class="border p-4 rounded-lg">
                        <legend class="font-bold text-lg px-2 text-gray-700">‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-2">
                            <div><label for="recorder-name" class="font-bold">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label><input type="text" id="recorder-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" class="w-full mt-1 p-2 border rounded-md"></div>
                            <div>
                                <label for="approver-name" class="font-bold">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</label>
                                <input type="text" id="approver-name" value="" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á" class="w-full mt-1 p-2 border rounded-md">
                                <label for="approver-title" class="font-bold mt-2 inline-block">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</label>
                                <input type="text" id="approver-title" value="" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" class="w-full mt-1 p-2 border rounded-md">
                            </div>
                        </div>
                    </fieldset>
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4 pt-6 border-t mt-6">
                        <button type="button" id="submit-btn" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 shadow-md">üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</button>
                        <button type="button" id="clear-data" class="w-full sm:w-auto bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 shadow-md">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="dashboard-tab" class="tab-content">
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-gray-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PLC</h1>
                    <button id="refresh-dashboard" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="py-3 px-4 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
                                <th class="py-3 px-4 text-left">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                <th class="py-3 px-4 text-left">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</th>
                                <th class="py-3 px-4 text-left">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞</th>
                                <th class="py-3 px-4 text-left">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
                                <th class="py-3 px-4 text-center">‡πÑ‡∏ü‡∏•‡πå PDF</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-tbody"></tbody>
                    </table>
                    <div id="dashboard-loader" class="text-center py-10 hidden"><div class="loader mx-auto"></div><p class="mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loading-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full z-50"><div class="relative top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-72 p-8 bg-white rounded-lg shadow-xl text-center"><div class="loader mx-auto"></div><p id="loading-text" class="mt-4 text-lg font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p></div></div>
    
    <!-- --- UPDATED: Hidden container for the new PDF template --- -->
    <div id="output-page-1" class="output-page">
        <div class="header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <div>
                <strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û (Professional Learning Community : PLC)</strong><br>
                <span id="output-school-name"></span> <span id="output-office-name"></span>
            </div>
        </div>
        <table class="main-table" style="width: 100%; margin-top: 1rem;">
            <tbody>
                <tr><td colspan="4" class="td-header" style="text-align: left;"><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô :</strong> <span id="output-plc-level" style="font-weight: normal;"></span></td></tr>
                <tr><td class="td-header" style="width: 25%; border-right: none;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PLC ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà :</td><td id="output-plc-number" style="width: 25%; border-left: none;"></td><td class="td-header" style="width: 25%; border-right: none;">‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ :</td><td id="output-plc-date" style="width: 25%; border-left: none;"></td></tr>
                <tr><td class="td-header" style="border-right: none;">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° - ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î :</td><td id="output-plc-time" style="border-left: none;"></td><td class="td-header" style="border-right: none;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á :</td><td id="output-plc-hours" style="border-left: none;"></td></tr>
                <tr><td class="td-header" style="border-right: none;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà PLC :</td><td colspan="3" id="output-plc-location" style="border-left: none;"></td></tr>
                <tr><td class="td-header" style="border-right: none;">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° PLC :</td><td colspan="3" id="output-plc-leader" style="border-left: none;"></td></tr>
                <tr>
                    <td colspan="4" style="padding: 0;">
                        <table style="width: 100%; border-collapse: collapse; border: none;">
                            <tbody>
                                <tr>
                                    <td class="td-header" colspan="2" style="text-align: left; border: none; padding: 4pt 6pt;">‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å PLC :</td>
                                </tr>
                                <tr>
                                    <td style="width: 50%; padding: 4pt 6pt; border: none; vertical-align: top;"><div id="output-members-col1"></div></td>
                                    <td style="width: 50%; padding: 4pt 6pt; border: none; vertical-align: top;"><div id="output-members-col2"></div></td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr><td colspan="4" class="content-cell"><strong>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö :</strong><br><span id="output-topic"></span></td></tr>
                <tr><td colspan="4" class="content-cell"><strong>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ :</strong><br><span id="output-reason"></span></td></tr>
                <tr><td colspan="4" class="content-cell"><strong>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç :</strong><br><span id="output-solution"></span></td></tr>
                <tr><td colspan="4" class="content-cell"><strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠/‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏õ‡∏±‡∏ç‡∏´‡∏≤ :</strong><br><span id="output-tools"></span></td></tr>
                <tr><td colspan="4" class="content-cell" style="min-height: 6em;"><strong>‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç :</strong><br><span id="output-results"></span></td></tr>
                <tr>
                    <td colspan="2" style="text-align: center; height: 10em; vertical-align: middle; padding: 5px;">
                        <img id="output-image-1" src="" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û 1" style="max-width: 100%; max-height: 10em; object-fit: contain; display: none;">
                    </td>
                    <td colspan="2" style="text-align: center; height: 10em; vertical-align: middle; padding: 5px;">
                        <img id="output-image-2" src="" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û 2" style="max-width: 100%; max-height: 10em; object-fit: contain; display: none;">
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="signature-section">
            <div class="signature-block"><p>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠...........................................‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p><p>( <span id="output-recorder-name">&nbsp;</span> )</p></div>
            <div class="signature-block"><p>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠...........................................‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</p><p>( <span id="output-approver-name">&nbsp;</span> )</p><p id="output-approver-title"></p></div>
        </div>
    </div>
    
    <!-- This second page is now removed as images are on the first page -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzB7IbN6jq7KwoiNoWg18kcbL5uZGHDr-x6IUCHv8ZiUtzaLUh0WDZO_AQEM_p9TeUg/exec";
            
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const form = document.getElementById('plc-form');
            const submitBtn = document.getElementById('submit-btn');
            const clearDataBtn = document.getElementById('clear-data');
            const loadingModal = document.getElementById('loading-modal');
            const loadingText = document.getElementById('loading-text');
            const timeStartInput = document.getElementById('plc-time-start');
            const timeEndInput = document.getElementById('plc-time-end');
            const hoursInput = document.getElementById('plc-hours');
            const imageUpload = document.getElementById('image-upload');
            const imagePreview = document.getElementById('image-preview');
            const dashboardTbody = document.getElementById('dashboard-tbody');
            const refreshDashboardBtn = document.getElementById('refresh-dashboard');
            const dashboardLoader = document.getElementById('dashboard-loader');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const tabName = button.dataset.tab;
                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.id === `${tabName}-tab`);
                    });
                    if (tabName === 'dashboard') fetchDashboardData();
                });
            });

            async function fetchDashboardData() {
                dashboardLoader.classList.remove('hidden');
                dashboardTbody.innerHTML = '';
                try {
                    const response = await fetch(SCRIPT_URL);
                    const result = await response.json();
                    if (result.status === 'success') renderDashboard(result.data);
                    else throw new Error(result.message);
                } catch (error) {
                    dashboardTbody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}</td></tr>`;
                } finally {
                    dashboardLoader.classList.add('hidden');
                }
            }

            function renderDashboard(data) {
                if (data.length === 0) {
                    dashboardTbody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                    return;
                }
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.className = 'border-b hover:bg-gray-50';
                    tr.innerHTML = `
                        <td class="py-3 px-4">${row['Timestamp'] || ''}</td>
                        <td class="py-3 px-4">${row['‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'] || ''}</td>
                        <td class="py-3 px-4">${row['‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà'] || ''}</td>
                        <td class="py-3 px-4">${row['‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞'] || ''}</td>
                        <td class="py-3 px-4">${row['‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'] || ''}</td>
                        <td class="py-3 px-4 text-center">
                            <a href="${row['‡∏•‡∏¥‡∏á‡∏Å‡πå PDF']}" target="_blank" class="text-blue-500 hover:underline" ${!row['‡∏•‡∏¥‡∏á‡∏Å‡πå PDF'] || row['‡∏•‡∏¥‡∏á‡∏Å‡πå PDF'] === '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå' ? 'style="pointer-events:none; color:grey;"' : ''}>‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå</a>
                        </td>
                    `;
                    dashboardTbody.appendChild(tr);
                });
            }

            refreshDashboardBtn.addEventListener('click', fetchDashboardData);
            
            clearDataBtn.addEventListener('click', () => {
                if(confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    form.reset();
                    imagePreview.innerHTML = '';
                }
            });

            imageUpload.addEventListener('change', (event) => {
                const files = event.target.files;
                if (files.length > 2) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏£‡∏π‡∏õ');
                    imageUpload.value = ''; // Clear the selection
                    imagePreview.innerHTML = '';
                    return;
                }

                imagePreview.innerHTML = '';
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-full h-auto object-cover rounded-lg border';
                        imagePreview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            });

            function calculateDuration() {
                const startTime = timeStartInput.value;
                const endTime = timeEndInput.value;
                if (!startTime || !endTime) { hoursInput.value = ''; return; }
                const start = new Date(`1970-01-01T${startTime}`);
                const end = new Date(`1970-01-01T${endTime}`);
                if (end <= start) { hoursInput.value = ''; return; }
                const diffMs = end - start;
                const totalMinutes = Math.floor(diffMs / 60000);
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                let durationString = '';
                if (hours > 0) durationString += `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
                if (minutes > 0) { if (durationString) durationString += ' '; durationString += `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`; }
                hoursInput.value = durationString;
            }

            timeStartInput.addEventListener('input', calculateDuration);
            timeEndInput.addEventListener('input', calculateDuration);

            function populateOutputData() {
                // Populate Page 1
                document.getElementById('output-school-name').textContent = document.getElementById('school-name').value;
                document.getElementById('output-office-name').textContent = document.getElementById('office-name').value;
                document.getElementById('output-plc-level').textContent = document.getElementById('plc-level').value;
                document.getElementById('output-plc-number').textContent = document.getElementById('plc-number').value;
                const dateValue = document.getElementById('plc-date').value;
                if (dateValue) {
                    const date = new Date(dateValue);
                    document.getElementById('output-plc-date').textContent = `${date.getDate()} ${date.toLocaleString('th-TH', { month: 'long' })} ${date.getFullYear() + 543}`;
                } else { document.getElementById('output-plc-date').innerHTML = '&nbsp;'; }
                const startTime = document.getElementById('plc-time-start').value;
                const endTime = document.getElementById('plc-time-end').value;
                document.getElementById('output-plc-time').textContent = startTime && endTime ? `${startTime} - ${endTime}` : '';
                document.getElementById('output-plc-hours').textContent = document.getElementById('plc-hours').value;
                document.getElementById('output-plc-location').textContent = document.getElementById('plc-location').value;
                document.getElementById('output-plc-leader').textContent = document.getElementById('plc-leader').value;
                document.getElementById('output-topic').textContent = document.getElementById('topic').value;
                document.getElementById('output-reason').textContent = document.getElementById('reason').value;
                document.getElementById('output-solution').textContent = document.getElementById('solution').value;
                document.getElementById('output-tools').textContent = document.getElementById('tools').value;
                document.getElementById('output-results').textContent = document.getElementById('results').value;
                document.getElementById('output-recorder-name').textContent = document.getElementById('recorder-name').value;
                document.getElementById('output-approver-name').textContent = document.getElementById('approver-name').value;
                document.getElementById('output-approver-title').textContent = document.getElementById('approver-title').value;
                const col1 = document.getElementById('output-members-col1');
                const col2 = document.getElementById('output-members-col2');
                col1.innerHTML = '';
                col2.innerHTML = '';
                for (let i = 1; i <= 10; i++) {
                    const memberName = document.getElementById(`member-${i}`).value;
                    const div = document.createElement('div');
                    div.style.display = 'flex';
                    div.style.alignItems = 'baseline';
                    div.style.lineHeight = '2';
                    const numberSpan = document.createElement('span');
                    numberSpan.style.width = '2em';
                    numberSpan.style.flexShrink = '0';
                    numberSpan.textContent = `${i}.`;
                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = (memberName ? memberName.replace(/^\d+\.\s*/, '') : '');
                    div.appendChild(numberSpan);
                    div.appendChild(nameSpan);
                    if (i <= 5) { col1.appendChild(div); } 
                    else { 
                        numberSpan.textContent = `${i}.`;
                        col2.appendChild(div); 
                    }
                }
                
                // --- MODIFIED: Populate images on Page 1 ---
                const img1 = document.getElementById('output-image-1');
                const img2 = document.getElementById('output-image-2');
                const previewImages = imagePreview.getElementsByTagName('img');
                
                img1.src = '';
                img1.style.display = 'none';
                img2.src = '';
                img2.style.display = 'none';

                if (previewImages[0]) {
                    img1.src = previewImages[0].src;
                    img1.style.display = 'inline-block';
                }
                if (previewImages[1]) {
                    img2.src = previewImages[1].src;
                    img2.style.display = 'inline-block';
                }
            }
            
            const toBase64 = file => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });

            submitBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                loadingModal.classList.remove('hidden');
                try {
                    loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
                    populateOutputData();

                    loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF...';
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const page1Canvas = await html2canvas(document.getElementById('output-page-1'), { scale: 2, useCORS: true });
                    const page1ImgData = page1Canvas.toDataURL('image/png');
                    const page1ImgProps = pdf.getImageProperties(page1ImgData);
                    const page1ImgRatio = page1ImgProps.width / page1ImgProps.height;
                    pdf.addImage(page1ImgData, 'PNG', 0, 0, pdfWidth, pdfWidth / page1ImgRatio);
                    
                    const pdfBase64 = pdf.output('datauristring').split(',')[1];

                    loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
                    const imagesData = await Promise.all(Array.from(imageUpload.files).map(async file => {
                        const base64 = await toBase64(file);
                        return { name: file.name, mimeType: file.type, data: base64 };
                    }));

                    const members = [];
                    for (let i = 1; i <= 10; i++) members.push(document.getElementById(`member-${i}`).value || '');
                    
                    const formData = {
                        schoolName: document.getElementById('school-name').value,
                        officeName: document.getElementById('office-name').value,
                        plcLevel: document.getElementById('plc-level').value,
                        plcNumber: document.getElementById('plc-number').value,
                        plcDate: document.getElementById('plc-date').value,
                        plcTime: `${document.getElementById('plc-time-start').value} - ${document.getElementById('plc-time-end').value}`,
                        plcHours: document.getElementById('plc-hours').value,
                        plcLocation: document.getElementById('plc-location').value,
                        plcLeader: document.getElementById('plc-leader').value,
                        members: members,
                        topic: document.getElementById('topic').value,
                        reason: document.getElementById('reason').value,
                        solution: document.getElementById('solution').value,
                        tools: document.getElementById('tools').value,
                        results: document.getElementById('results').value,
                        recorderName: document.getElementById('recorder-name').value,
                        approverName: document.getElementById('approver-name').value,
                        approverTitle: document.getElementById('approver-title').value,
                        pdfFile: { name: `plc-record-${document.getElementById('plc-number').value || 'data'}.pdf`, data: pdfBase64 },
                        images: imagesData
                    };

                    loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Drive...';
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();
                    if (result.status === 'success') {
                        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                        pdf.save(`plc-record-${document.getElementById('plc-number').value || 'data'}.pdf`);
                        form.reset();
                        imagePreview.innerHTML = '';
                    } else {
                        throw new Error(result.message);
                    }
                } catch (error) {
                    console.error("Error submitting form:", error);
                    let userMessage = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}\n\n`;
                    if (error.message.includes("Failed to fetch")) {
                        userMessage += "‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á Google Apps Script ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ Deploy ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ 'Who has access' ‡πÄ‡∏õ‡πá‡∏ô 'Anyone' (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô) ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
                    }
                    alert(userMessage);
                } finally {
                    loadingModal.classList.add('hidden');
                }
            });

            // Initial load for dashboard
            fetchDashboardData();
        });
    </script>
</body>
</html>

